{"ast":null,"code":"import { createSlice } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { createAppThunk } from \"./store\";\nimport * as modal from \"./modal/modal.slice\";\n\nfunction nextReasonID(reasons) {\n  const maxId = reasons.reduce((maxId, reason) => Math.max(reason.id, maxId), -1);\n  return maxId + 1;\n}\n\nconst initialState = {\n  imageID: 0,\n  screen: \"pick\",\n  marked: {},\n  reasons: [\"Background\", \"Eyes\"].map((label, _, arr) => ({\n    id: nextReasonID(arr),\n    label\n  }))\n};\nconst appSlice = createSlice({\n  name: \"trainer\",\n  initialState,\n  reducers: {\n    real: state => {\n      state.imageID = (state.imageID + 1) % 16;\n    },\n    unreal: state => {\n      state.screen = \"modal\";\n    },\n    confirm: (state, action) => {\n      const {\n        reasonIDs,\n        otherReason\n      } = action.payload;\n      const mark = {\n        imageID: state.imageID,\n        reasonIDs\n      };\n      state.marked[state.imageID] = {\n        imageID: state.imageID,\n        reasonIDs\n      };\n\n      if (otherReason) {\n        var _state$marked$state$i;\n\n        const id = nextReasonID(state.reasons);\n        state.reasons.push({\n          id,\n          label: otherReason\n        });\n        (_state$marked$state$i = state.marked[state.imageID]) === null || _state$marked$state$i === void 0 ? void 0 : _state$marked$state$i.reasonIDs.push(id);\n      }\n\n      state.screen = \"pick\";\n      state.imageID = (state.imageID + 1) % 16;\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(modal.cancel, state => {\n      state.screen = \"pick\";\n    });\n  }\n});\nexport const initialise = createAppThunk(\"trainer/init\", async () => {\n  const response = await axios.get(\"http://localhost:3000/api/v1/image?id=1\", {\n    responseType: \"stream\"\n  });\n  console.log(response);\n});\nexport const {\n  confirm,\n  real,\n  unreal\n} = appSlice.actions;\nexport default appSlice.reducer;","map":{"version":3,"sources":["/home/tomw/ai-trainer/client/src/app.slice.ts"],"names":["createSlice","axios","createAppThunk","modal","nextReasonID","reasons","maxId","reduce","reason","Math","max","id","initialState","imageID","screen","marked","map","label","_","arr","appSlice","name","reducers","real","state","unreal","confirm","action","reasonIDs","otherReason","payload","mark","push","extraReducers","builder","addCase","cancel","initialise","response","get","responseType","console","log","actions","reducer"],"mappings":"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","sourcesContent":["import {\n  createSlice,\n  Dictionary,\n  nanoid,\n  PayloadAction,\n} from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { AppState, createAppThunk } from \"./store\";\nimport * as modal from \"./modal/modal.slice\";\n\nfunction nextReasonID(reasons: Reason[]) {\n  const maxId = reasons.reduce(\n    (maxId, reason) => Math.max(reason.id, maxId),\n    -1\n  );\n  return maxId + 1;\n}\n\ntype Marked = { imageID: number; reasonIDs: number[] };\n\nexport type Reason = { id: number; label: string };\n\ninterface TrainerState {\n  imageID: number;\n  screen: \"pick\" | \"modal\" | \"report\";\n  marked: Dictionary<Marked>;\n  reasons: Reason[];\n}\n\nconst initialState: TrainerState = {\n  imageID: 0,\n  screen: \"pick\",\n  marked: {},\n  reasons: [\"Background\", \"Eyes\"].map((label, _, arr) => ({\n    id: nextReasonID(arr),\n    label,\n  })),\n};\n\nconst appSlice = createSlice({\n  name: \"trainer\",\n  initialState,\n  reducers: {\n    real: (state) => {\n      state.imageID = (state.imageID + 1) % 16;\n    },\n    unreal: (state) => {\n      state.screen = \"modal\";\n    },\n    confirm: (state, action: PayloadAction<SubmitPhotoPayload>) => {\n      const { reasonIDs, otherReason } = action.payload;\n      const mark: Marked = { imageID: state.imageID, reasonIDs };\n\n      state.marked[state.imageID] = {\n        imageID: state.imageID,\n        reasonIDs,\n      };\n\n      if (otherReason) {\n        const id = nextReasonID(state.reasons);\n        state.reasons.push({ id, label: otherReason });\n        state.marked[state.imageID]?.reasonIDs.push(id);\n      }\n\n      state.screen = \"pick\";\n      state.imageID = (state.imageID + 1) % 16;\n    },\n  },\n  extraReducers: (builder) => {\n    builder.addCase(modal.cancel, (state) => {\n      state.screen = \"pick\";\n    });\n  },\n});\n\nexport type SubmitPhotoPayload = {\n  reasonIDs: number[];\n  otherReason: string;\n};\n\nexport const initialise = createAppThunk(\"trainer/init\", async () => {\n  const response = await axios.get(\"http://localhost:3000/api/v1/image?id=1\", {\n    responseType: \"stream\",\n  });\n  console.log(response);\n});\n\nexport const { confirm, real, unreal } = appSlice.actions;\n\nexport default appSlice.reducer;\n"]},"metadata":{},"sourceType":"module"}